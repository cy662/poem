# n8n手动设置指南（解决导入问题）

## 🔧 问题解决方案

如果自动导入失败，您可以手动创建n8n工作流：

### 方法一：使用简化版工作流
1. 尝试导入 `docs/n8n-simple-workflow.json`
2. 这个版本更简单，兼容性更好

### 方法二：手动创建工作流（推荐）

**步骤1：创建新工作流**
1. 访问 http://localhost:5678
2. 点击左侧菜单"Workflows"
3. 点击"New Workflow"
4. 给工作流命名："诗词AI助手"

**步骤2：添加Webhook节点**
1. 在节点面板搜索"webhook"
2. 拖拽"Webhook"节点到画布
3. 配置节点：
   - **Path**: `poem-ai-assistant`
   - **Response Mode**: `Respond to Webhook`

**步骤3：添加Code节点**
1. 搜索"code"或"function"
2. 拖拽"Code"节点到画布
3. 连接Webhook节点到Code节点
4. 粘贴以下代码：

```javascript
// 获取用户问题
const question = $input.first().json.question;

// 扩展的诗词知识库
const knowledge = {
  // 诗人介绍
  '李白': '李白（701年－762年），字太白，号青莲居士，唐代伟大的浪漫主义诗人，被后人誉为"诗仙"。其诗豪放飘逸，想象丰富，语言流转自然。代表作品：《静夜思》、《将进酒》、《蜀道难》。',
  '杜甫': '杜甫（712年－770年），字子美，自号少陵野老，唐代伟大的现实主义诗人，被尊为"诗圣"。其诗沉郁顿挫，反映社会现实。代表作品：《春望》、《登高》、《茅屋为秋风所破歌》。',
  '苏轼': '苏轼（1037年－1101年），字子瞻，号东坡居士，北宋文学家、书画家，豪放派词人代表。诗词文赋皆精，风格豪放洒脱。代表作品：《水调歌头》、《念奴娇·赤壁怀古》。',
  '李清照': '李清照（1084年－1155年），号易安居士，宋代女词人，婉约派代表。其词语言清丽，感情真挚。代表作品：《声声慢》、《如梦令》。',
  
  // 诗词体裁
  '唐诗': '唐诗是中国古典诗歌的黄金时代，分为初唐、盛唐、中唐、晚唐四个时期。讲究格律，形式严谨，意境深远。',
  '宋词': '宋词是宋代文学的代表，句式灵活，适合配乐歌唱。分为婉约派和豪放派两大流派。',
  '元曲': '元曲是元代文学的代表，包括散曲和杂剧，语言通俗生动，贴近人民生活。',
  
  // 名句解释
  '床前明月光': '出自李白的《静夜思》。描写游子在寂静的月夜思念家乡的感受，语言简练，意境深远。',
  '大江东去': '出自苏轼的《念奴娇·赤壁怀古》。以长江东流起兴，抒发对历史英雄的怀念和对人生短暂的感慨。',
  
  // 快速回复
  '推荐': '我为您推荐以下几首经典诗词：\n1. 李白《静夜思》- 简洁明快，思乡情深\n2. 杜甫《春望》- 忧国忧民，沉郁顿挫\n3. 苏轼《水调歌头》- 豪放洒脱，意境开阔',
  '解释': '请提供具体的诗句或关键词，我会为您详细解释其含义、创作背景和艺术特色。',
  '区别': '唐诗注重格律和意境，形式严谨；宋词更注重音乐性和抒情性，句式灵活多变。'
};

// 智能匹配
let answer = '这是一个很好的诗词问题！中国诗词文化源远流长，涉及到丰富的文学知识和历史背景。' +
             '建议您提供更具体的关键词，比如诗人名字、诗句内容或诗词体裁，我会为您详细解答。';

// 关键词匹配
for (const [key, value] of Object.entries(knowledge)) {
  if (question && question.includes(key)) {
    answer = value;
    break;
  }
}

// 返回响应
return [{ 
  json: { 
    answer: answer,
    success: true,
    timestamp: new Date().toISOString()
  } 
}];
```

**步骤4：添加响应节点**
1. 从Code节点连接线到画布空白处
2. 选择"Webhook"作为响应节点
3. 工作流完成！

**步骤5：激活工作流**
1. 点击右上角"Active"开关
2. 等待工作流激活（变为绿色）

## 🚀 测试工作流

**方法一：使用n8n测试功能**
1. 点击工作流右上角"Test"按钮
2. 输入测试数据：
```json
{
  "question": "推荐一首唐诗"
}
```
3. 点击"Execute Workflow"
4. 查看响应结果

**方法二：使用curl命令测试**
```bash
curl -X POST http://localhost:5678/webhook/poem-ai-assistant \
  -H "Content-Type: application/json" \
  -d '{"question": "介绍李白"}'
```

## 🔧 环境变量配置

创建 `.env.local` 文件：
```env
VITE_N8N_BASE_URL=http://localhost:5678
VITE_N8N_WEBHOOK_PATH=/webhook/poem-ai-assistant
VITE_N8N_API_KEY=your-api-key-here
```

## 🐛 常见问题解决

### 问题1：Webhook节点报错
**错误**：Webhook路径已存在
**解决**：修改Path为唯一值，如 `poem-ai-助手-123`

### 问题2：代码执行错误
**错误**：JavaScript语法错误
**解决**：检查代码格式，确保所有括号匹配

### 问题3：工作流无法激活
**错误**：节点连接问题
**解决**：确保所有节点正确连接，没有断开的地方

## ✅ 验证配置

完成设置后，测试以下问题：
- "介绍李白"
- "什么是唐诗"
- "推荐一首经典诗词"

如果收到智能回复，说明n8n集成成功！

这个手动方法更可靠，避免了JSON导入的兼容性问题。